window.onload = function(){
  $('#inspection_jp_report').addClass('active');
//  get_maintenance_reports();
  get_all_stations();
};
var token =  $("input[name=_token]").val();
function get_all_stations(){
	$.ajax({
		url: '/common/allstations',
		type: 'GET',
		dataType: 'JSON',
		success: function(data){
			$('#station_id').empty();
			for(var i in data){
			  $('#station_id').append('<option value="'+data[i].id+'">'+data[i].code+'</option>');
			}
		}
	}).promise().done(function(data) {
        $select_station_id = $('#select_station_id').selectize({
        	maxItems: null,valueField: 'id',labelField: 'code',searchField: 'code',options: data,create: false
        });
    });
}
$(function(){
    $( "#from_date" ).datepicker({
      defaultDate: "+0D",
      maxDate: "+0D",
      changeMonth: true,
      dateFormat: 'dd-mm-yy',
      onClose: function( selectedDate ) {
        $( "#to_date" ).datepicker( "option", "minDate", selectedDate );
      }
    });
    var fromDate =$( "#from_date" ).val();
    $( "#to_date" ).datepicker({
      minDate: fromDate,
      maxDate: "+0D",
      changeMonth: true,
      numberOfMonths: 2,
      dateFormat: 'dd-mm-yy',
      onClose: function( selectedDate ) {
        $( "#from_date" ).datepicker( "option", "maxDate", selectedDate );
      }
    });
});

function get_inspection_reports(){
  var formData = $('form#station_report_form').serializeArray();

  var fromDate =$( "#from_date" ).val();
  var toDate =$( "#to_date" ).val();
if(fromDate!='' && toDate!=''){
  $('#data-list').html('<tr><td colspan="9"><center><i class="fa fa-spinner fa-spin fa-3x"></i></center></td></tr>')

  $.ajax({
    url: '/report/jpinspectionreports',
    type: 'POST',
    datatype: 'JSON',
    data: formData,
    success: function(data){
      $('#data-list').empty();
      if(data.length==0){
        $('#data-list').append('<tr><td colspan="9"><center><h4 class="label label-danger text-center">No data found</h4></center></td></tr>');
      }
        for(var i in data){
          var next_date_row=moment(data[i].due_date_of_inspection).format('DD/MM/YY');

 				 if(data[i].role=='SS'){
 				 	next_date_row=next_date_row+'  for IC';
 				 }else{
 					 next_date_row=next_date_row+'  for SS';
 				 }
          var row = '<tr>'
    					+'<td>'+data[i].code+'</td>'
    					+'<td>'+data[i].maintenance_by+'</td>'
    					+'<td>'+data[i].designation+'</td>'
    					+'<td>'+data[i].role+'</td>'
              +'<td>'+moment(data[i].date_of_inspection).format('DD/MM/YY')+'</td>'
            	+'<td>'+next_date_row+'</td>'
    					+'</tr>';
    			$('#data-list').append(row);


        }

      }

  });
}else{

  alertify.error('Please select from date and to date!');
}
}
$("#print_report").on("click", function () {
 printDiv();

});
function printDiv()
{

  //moment(data[i].maintenance_date).format('DD/MM/YY')
  var fromDate =$("#from_date" ).val();
  var toDate =$("#to_date" ).val();
  var station_ids =$("#select_station_id" ).val();
  var divToPrint=document.getElementById('maintenance_reports');
  newWin= window.open("");

  newWin.document.write('<h3>Station Wise Joint Point & X-ing Inspection Report from <small>'+fromDate+' To '+toDate+'</small></h3>');
  newWin.document.write(divToPrint.outerHTML);
  newWin.document.write('<small>Report generated by DSMG monitoring software (Tinsukia Division): all date format are in <b>dd/mm/yy</b></small>');
  newWin.print();
  newWin.close();

  //window.open("/report/generatepdf?station_ids="+station_ids+"&fromDate="+fromDate+"&toDate="+toDate);



}
$("#excel_report").click(function() {
	$("#maintenance_reports").table2excel({
		exclude : ".noExl",
    name : "maintainance_report",
    filename: "maintainance_report"
	});
});
